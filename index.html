<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis de Apuestas Deportivas 2025-2026</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .api-config {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .leagues-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .league-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .league-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .match-selector {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-size: 18px;
        }

        .data-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .statistics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .success {
            background: #51cf66;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .team-comparison {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 20px;
            margin: 20px 0;
            align-items: center;
        }

        .team-stats {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .vs-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 50%;
            text-align: center;
            font-weight: bold;
            font-size: 1.2em;
        }

        .export-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .team-comparison {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .vs-badge {
                margin: 10px auto;
                width: 80px;
                height: 80px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ An√°lisis de Apuestas Deportivas 2025-2026</h1>
            <div class="api-config">
                <div class="form-group">
                    <label for="apiProvider">Proveedor de API:</label>
                    <select id="apiProvider" onchange="updateApiConfig()">
                        <option value="api-football">API-Football (Gratis/Premium)</option>
                        <option value="football-data">Football-Data.org (Gratis/Premium)</option>
                        <option value="rapidapi-football">RapidAPI Football (Premium)</option>
                        <option value="sportmonks">SportMonks API (Premium)</option>
                        <option value="the-odds-api">The Odds API (Gratis/Premium)</option>
                        <option value="api-sports">API-Sports.io (Premium)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="apiPlan">Plan de API:</label>
                    <select id="apiPlan" onchange="updatePlanLimits()">
                        <option value="free">Gratuito</option>
                        <option value="basic">B√°sico</option>
                        <option value="pro">Profesional</option>
                        <option value="ultra">Ultra</option>
                        <option value="mega">Mega</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="apiKey">API Key:</label>
                    <input type="password" id="apiKey" placeholder="Ingresa tu API Key">
                    <div id="apiInfo" style="margin-top: 10px; padding: 10px; background: #f0f8ff; border-radius: 5px;">
                        <small id="planDetails">Selecciona un proveedor para ver los detalles del plan</small>
                    </div>
                </div>
                <div class="form-group">
                    <label for="apiEndpoint">Endpoint Base (Opcional - para APIs personalizadas):</label>
                    <input type="text" id="apiEndpoint" placeholder="https://api.ejemplo.com/v1">
                </div>
                <button class="btn" onclick="saveApiKey()">Guardar Configuraci√≥n</button>
                <button class="btn" onclick="testConnection()">Probar Conexi√≥n</button>
                <button class="btn" onclick="showApiLimits()">Ver L√≠mites</button>
                <button class="btn" onclick="exportApiConfig()">üíæ Exportar Config</button>
                <button class="btn" onclick="importApiConfig()">üìÇ Importar Config</button>
                <button class="btn" onclick="recommendUpgrade()">üöÄ Recomendar Plan</button>
            </div>
        </div>

        <div class="match-selector">
            <h2>Seleccionar Partido</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="form-group">
                    <label for="leagueSelect">Liga:</label>
                    <select id="leagueSelect" onchange="loadTeams()">
                        <option value="">Seleccionar Liga</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="homeTeam">Equipo Local:</label>
                    <select id="homeTeam">
                        <option value="">Seleccionar Equipo Local</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="awayTeam">Equipo Visitante:</label>
                    <select id="awayTeam">
                        <option value="">Seleccionar Equipo Visitante</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="season">Temporada:</label>
                    <select id="season">
                        <option value="2025">2025</option>
                        <option value="2024">2024</option>
                    </select>
                </div>
            </div>
            <button class="btn" onclick="analyzeMatch()">Analizar Partido</button>
            <button class="btn" onclick="loadLiveMatches()">Partidos en Vivo</button>
        </div>

        <div id="results"></div>

        <div class="export-section">
            <h3>Exportar Datos</h3>
            <button class="btn" onclick="exportToExcel()">üìä Exportar a Excel</button>
            <button class="btn" onclick="exportToCSV()">üìã Exportar a CSV</button>
            <button class="btn" onclick="generateReport()">üìë Generar Reporte PDF</button>
        </div>
    </div>

    <script>
        // Configuraci√≥n de ligas con sus IDs de la API
        const LEAGUES = {
            // Am√©rica
            'MLS': { id: 253, country: 'USA', name: 'Major League Soccer' },
            'Liga MX': { id: 262, country: 'Mexico', name: 'Liga MX' },
            'Costa Rica': { id: 159, country: 'Costa Rica', name: 'Primera Divisi√≥n' },
            'Colombia': { id: 239, country: 'Colombia', name: 'Primera A' },
            'Ecuador': { id: 242, country: 'Ecuador', name: 'Serie A' },
            'Peru': { id: 281, country: 'Peru', name: 'Primera Divisi√≥n' },
            'Chile': { id: 265, country: 'Chile', name: 'Primera Divisi√≥n' },
            'Argentina': { id: 128, country: 'Argentina', name: 'Liga Profesional' },
            'Brasil': { id: 71, country: 'Brazil', name: 'Serie A' },
            'Uruguay': { id: 218, country: 'Uruguay', name: 'Primera Divisi√≥n' },
            
            // Europa
            'Suecia': { id: 113, country: 'Sweden', name: 'Allsvenskan' },
            'B√©lgica': { id: 144, country: 'Belgium', name: 'First Division A' },
            'Dinamarca': { id: 119, country: 'Denmark', name: 'Superliga' },
            'Rumania': { id: 283, country: 'Romania', name: 'Liga 1' },
            'Polonia': { id: 106, country: 'Poland', name: 'Ekstraklasa' },
            'Suiza': { id: 207, country: 'Switzerland', name: 'Super League' },
            'Francia': { id: 61, country: 'France', name: 'Ligue 1' },
            'Espa√±a': { id: 140, country: 'Spain', name: 'La Liga' },
            'Italia': { id: 135, country: 'Italy', name: 'Serie A' },
            'Portugal': { id: 94, country: 'Portugal', name: 'Primeira Liga' },
            'Pa√≠ses Bajos': { id: 88, country: 'Netherlands', name: 'Eredivisie' },
            'Turqu√≠a': { id: 203, country: 'Turkey', name: 'Super Lig' },
            'Premier League': { id: 39, country: 'England', name: 'Premier League' },
            'Championship': { id: 40, country: 'England', name: 'Championship' },
            'Escocia': { id: 179, country: 'Scotland', name: 'Premiership' },
            'Bundesliga': { id: 78, country: 'Germany', name: 'Bundesliga' },
            'Bundesliga 2': { id: 79, country: 'Germany', name: '2. Bundesliga' }
        };

        let API_KEY = '';
        let API_PROVIDER = 'api-football';
        let API_PLAN = 'free';
        let API_ENDPOINT = '';
        let matchData = {};
        let analysisData = {};
        let requestCount = 0;
        let dailyLimit = 100;

        // Configuraci√≥n de APIs y planes
        const API_CONFIGS = {
            'api-football': {
                name: 'API-Football',
                baseUrl: 'https://v3.football.api-sports.io',
                website: 'https://www.api-football.com/',
                plans: {
                    free: { requests: 100, price: 'Gratis', features: 'Datos b√°sicos, 100 requests/d√≠a' },
                    basic: { requests: 1000, price: '$5/mes', features: 'Datos completos, 1,000 requests/d√≠a' },
                    pro: { requests: 3000, price: '$15/mes', features: 'Datos avanzados, 3,000 requests/d√≠a' },
                    ultra: { requests: 10000, price: '$30/mes', features: 'Datos premium, 10,000 requests/d√≠a' },
                    mega: { requests: 50000, price: '$100/mes', features: 'Datos ilimitados, 50,000 requests/d√≠a' }
                },
                headers: {
                    'X-RapidAPI-Key': '',
                    'X-RapidAPI-Host': 'v3.football.api-sports.io'
                }
            },
            'football-data': {
                name: 'Football-Data.org',
                baseUrl: 'https://api.football-data.org/v4',
                website: 'https://www.football-data.org/',
                plans: {
                    free: { requests: 10, price: 'Gratis', features: 'Datos limitados, 10 requests/min' },
                    basic: { requests: 100, price: '$12/mes', features: 'M√°s competiciones, 100 requests/min' },
                    pro: { requests: 500, price: '$50/mes', features: 'Datos completos, 500 requests/min' }
                },
                headers: {
                    'X-Auth-Token': ''
                }
            },
            'rapidapi-football': {
                name: 'RapidAPI Football',
                baseUrl: 'https://api-football-v1.p.rapidapi.com/v3',
                website: 'https://rapidapi.com/api-sports/api/api-football/',
                plans: {
                    basic: { requests: 500, price: '$10/mes', features: 'Datos b√°sicos, 500 requests/d√≠a' },
                    pro: { requests: 2000, price: '$25/mes', features: 'Datos avanzados, 2,000 requests/d√≠a' },
                    ultra: { requests: 10000, price: '$60/mes', features: 'Datos premium, 10,000 requests/d√≠a' }
                },
                headers: {
                    'X-RapidAPI-Key': '',
                    'X-RapidAPI-Host': 'api-football-v1.p.rapidapi.com'
                }
            },
            'sportmonks': {
                name: 'SportMonks API',
                baseUrl: 'https://api.sportmonks.com/v3/football',
                website: 'https://www.sportmonks.com/',
                plans: {
                    basic: { requests: 1000, price: '$15/mes', features: 'Datos b√°sicos, 1,000 requests/d√≠a' },
                    pro: { requests: 5000, price: '$50/mes', features: 'Datos completos, 5,000 requests/d√≠a' },
                    ultra: { requests: 20000, price: '$150/mes', features: 'Datos premium, 20,000 requests/d√≠a' }
                },
                headers: {
                    'Authorization': ''
                }
            },
            'the-odds-api': {
                name: 'The Odds API',
                baseUrl: 'https://api.the-odds-api.com/v4/sports',
                website: 'https://the-odds-api.com/',
                plans: {
                    free: { requests: 500, price: 'Gratis', features: 'Cuotas b√°sicas, 500 requests/mes' },
                    basic: { requests: 2000, price: '$10/mes', features: 'M√°s mercados, 2,000 requests/mes' },
                    pro: { requests: 10000, price: '$40/mes', features: 'Datos completos, 10,000 requests/mes' }
                },
                headers: {
                    'X-API-Key': ''
                }
            },
            'api-sports': {
                name: 'API-Sports.io',
                baseUrl: 'https://api.api-sports.io/football',
                website: 'https://api-sports.io/',
                plans: {
                    basic: { requests: 1000, price: '$8/mes', features: 'Datos b√°sicos, 1,000 requests/d√≠a' },
                    pro: { requests: 5000, price: '$25/mes', features: 'Datos avanzados, 5,000 requests/d√≠a' },
                    ultra: { requests: 15000, price: '$75/mes', features: 'Datos premium, 15,000 requests/d√≠a' }
                },
                headers: {
                    'X-API-Key': ''
                }
            }
        };

        // Actualizar configuraci√≥n de API
        function updateApiConfig() {
            const provider = document.getElementById('apiProvider').value;
            API_PROVIDER = provider;
            
            const planSelect = document.getElementById('apiPlan');
            planSelect.innerHTML = '';
            
            Object.keys(API_CONFIGS[provider].plans).forEach(plan => {
                const option = document.createElement('option');
                option.value = plan;
                option.textContent = plan.charAt(0).toUpperCase() + plan.slice(1);
                planSelect.appendChild(option);
            });
            
            updatePlanLimits();
        }

        // Actualizar l√≠mites del plan
        function updatePlanLimits() {
            const provider = document.getElementById('apiProvider').value;
            const plan = document.getElementById('apiPlan').value;
            API_PLAN = plan;
            
            const config = API_CONFIGS[provider];
            const planInfo = config.plans[plan];
            
            if (planInfo) {
                dailyLimit = planInfo.requests;
                document.getElementById('planDetails').innerHTML = `
                    <strong>${config.name} - Plan ${plan.charAt(0).toUpperCase() + plan.slice(1)}</strong><br>
                    üìä Requests: ${planInfo.requests}/d√≠a<br>
                    üí∞ Precio: ${planInfo.price}<br>
                    ‚ú® Caracter√≠sticas: ${planInfo.features}<br>
                    üîó <a href="${config.website}" target="_blank">Obtener API Key</a>
                `;
            }
        }

        // Mostrar l√≠mites actuales
        function showApiLimits() {
            const provider = document.getElementById('apiProvider').value;
            const plan = document.getElementById('apiPlan').value;
            const config = API_CONFIGS[provider];
            const planInfo = config.plans[plan];
            
            const usagePercentage = ((requestCount / dailyLimit) * 100).toFixed(1);
            
            showMessage(`
                üìä L√≠mites de API - ${config.name}:
                ‚Ä¢ Plan: ${plan.toUpperCase()}
                ‚Ä¢ Usado: ${requestCount}/${dailyLimit} requests (${usagePercentage}%)
                ‚Ä¢ Restante: ${dailyLimit - requestCount} requests
                ‚Ä¢ Precio: ${planInfo.price}
            `, 'success');
        }

        // Realizar petici√≥n a API con manejo de diferentes proveedores
        async function makeApiRequest(endpoint, params = {}) {
            if (requestCount >= dailyLimit) {
                throw new Error(`L√≠mite de requests alcanzado (${dailyLimit}/d√≠a). Considera upgradar tu plan.`);
            }

            const provider = API_PROVIDER;
            const config = API_CONFIGS[provider];
            let url, headers;

            // Configurar URL y headers seg√∫n el proveedor
            switch (provider) {
                case 'api-football':
                    url = `${config.baseUrl}${endpoint}`;
                    headers = {
                        'X-RapidAPI-Key': API_KEY,
                        'X-RapidAPI-Host': 'v3.football.api-sports.io'
                    };
                    break;
                
                case 'football-data':
                    url = `${config.baseUrl}${endpoint}`;
                    headers = {
                        'X-Auth-Token': API_KEY
                    };
                    break;
                
                case 'rapidapi-football':
                    url = `${config.baseUrl}${endpoint}`;
                    headers = {
                        'X-RapidAPI-Key': API_KEY,
                        'X-RapidAPI-Host': 'api-football-v1.p.rapidapi.com'
                    };
                    break;
                
                case 'sportmonks':
                    url = `${config.baseUrl}${endpoint}`;
                    headers = {
                        'Authorization': `Bearer ${API_KEY}`
                    };
                    break;
                
                case 'the-odds-api':
                    url = `${config.baseUrl}${endpoint}`;
                    headers = {
                        'X-API-Key': API_KEY
                    };
                    break;
                
                case 'api-sports':
                    url = `${config.baseUrl}${endpoint}`;
                    headers = {
                        'X-API-Key': API_KEY
                    };
                    break;
                
                default:
                    // API personalizada
                    url = `${API_ENDPOINT || config.baseUrl}${endpoint}`;
                    headers = {
                        'Authorization': `Bearer ${API_KEY}`,
                        'X-API-Key': API_KEY
                    };
            }

            // Agregar par√°metros a la URL
            if (Object.keys(params).length > 0) {
                const urlParams = new URLSearchParams(params);
                url += (url.includes('?') ? '&' : '?') + urlParams.toString();
            }

            const response = await fetch(url, { headers });
            requestCount++;
            
            if (!response.ok) {
                throw new Error(`Error ${response.status}: ${response.statusText}`);
            }

            return await response.json();
        }

        // Cargar ligas al inicializar
        function initializeApp() {
            const leagueSelect = document.getElementById('leagueSelect');
            Object.keys(LEAGUES).forEach(league => {
                const option = document.createElement('option');
                option.value = league;
                option.textContent = `${league} (${LEAGUES[league].country})`;
                leagueSelect.appendChild(option);
            });
        }

        // Guardar configuraci√≥n de API
        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const provider = document.getElementById('apiProvider').value;
            const plan = document.getElementById('apiPlan').value;
            const endpoint = document.getElementById('apiEndpoint').value.trim();
            
            if (apiKey) {
                API_KEY = apiKey;
                API_PROVIDER = provider;
                API_PLAN = plan;
                API_ENDPOINT = endpoint;
                
                const config = API_CONFIGS[provider];
                const planInfo = config.plans[plan];
                dailyLimit = planInfo ? planInfo.requests : 100;
                requestCount = 0; // Reset counter
                
                showMessage(`Configuraci√≥n guardada: ${config.name} - Plan ${plan.toUpperCase()}`, 'success');
            } else {
                showMessage('Por favor ingresa una API Key v√°lida', 'error');
            }
        }

        // Probar conexi√≥n con diferentes APIs
        async function testConnection() {
            if (!API_KEY) {
                showMessage('Por favor configura tu API Key primero', 'error');
                return;
            }

            try {
                showMessage('Probando conexi√≥n...', 'loading');
                let data;

                switch (API_PROVIDER) {
                    case 'api-football':
                        data = await makeApiRequest('/status');
                        if (data.response) {
                            const remaining = data.response.requests.limit_day - data.response.requests.current;
                            showMessage(`‚úÖ Conexi√≥n exitosa con API-Football! Requests disponibles: ${remaining}`, 'success');
                        }
                        break;
                    
                    case 'football-data':
                        data = await makeApiRequest('/competitions');
                        if (data.competitions) {
                            showMessage(`‚úÖ Conexi√≥n exitosa con Football-Data! Competiciones disponibles: ${data.competitions.length}`, 'success');
                        }
                        break;
                    
                    case 'rapidapi-football':
                        data = await makeApiRequest('/status');
                        showMessage(`‚úÖ Conexi√≥n exitosa con RapidAPI Football!`, 'success');
                        break;
                    
                    case 'sportmonks':
                        data = await makeApiRequest('/leagues');
                        if (data.data) {
                            showMessage(`‚úÖ Conexi√≥n exitosa con SportMonks! Ligas disponibles: ${data.data.length}`, 'success');
                        }
                        break;
                    
                    case 'the-odds-api':
                        data = await makeApiRequest('/football_epl/odds');
                        showMessage(`‚úÖ Conexi√≥n exitosa con The Odds API!`, 'success');
                        break;
                    
                    case 'api-sports':
                        data = await makeApiRequest('/leagues');
                        showMessage(`‚úÖ Conexi√≥n exitosa con API-Sports!`, 'success');
                        break;
                    
                    default:
                        // API personalizada
                        data = await makeApiRequest('/status');
                        showMessage(`‚úÖ Conexi√≥n exitosa con API personalizada!`, 'success');
                }
            } catch (error) {
                showMessage(`‚ùå Error al conectar: ${error.message}`, 'error');
            }
        }

        // Cargar equipos seg√∫n la liga seleccionada
        async function loadTeams() {
            const league = document.getElementById('leagueSelect').value;
            const season = document.getElementById('season').value;
            
            if (!league || !API_KEY) return;

            try {
                showMessage('Cargando equipos...', 'loading');
                const leagueId = LEAGUES[league].id;
                let data;
                
                switch (API_PROVIDER) {
                    case 'api-football':
                    case 'rapidapi-football':
                        data = await makeApiRequest('/teams', { league: leagueId, season });
                        if (data.response) {
                            populateTeamSelects(data.response);
                            showMessage(`${data.response.length} equipos cargados`, 'success');
                        }
                        break;
                    
                    case 'football-data':
                        data = await makeApiRequest(`/competitions/${leagueId}/teams`);
                        if (data.teams) {
                            const formattedTeams = data.teams.map(team => ({ team }));
                            populateTeamSelects(formattedTeams);
                            showMessage(`${data.teams.length} equipos cargados`, 'success');
                        }
                        break;
                    
                    default:
                        data = await makeApiRequest('/teams', { league: leagueId, season });
                        if (data.response || data.data) {
                            const teams = data.response || data.data;
                            populateTeamSelects(teams);
                            showMessage(`${teams.length} equipos cargados`, 'success');
                        }
                }
                
            } catch (error) {
                showMessage('Error al cargar equipos: ' + error.message, 'error');
            }
        }

        // Cargar partidos en vivo eliminado (c√≥digo duplicado)

        // Inicializar aplicaci√≥n con configuraci√≥n por defecto
        function initializeApp() {
            const leagueSelect = document.getElementById('leagueSelect');
            Object.keys(LEAGUES).forEach(league => {
                const option = document.createElement('option');
                option.value = league;
                option.textContent = `${league} (${LEAGUES[league].country})`;
                leagueSelect.appendChild(option);
            });

            // Configurar API por defecto
            updateApiConfig();
        }

        // A√±adir funci√≥n para gestionar cuotas de apuestas
        async function getBettingOdds(homeTeamId, awayTeamId) {
            if (API_PROVIDER === 'the-odds-api') {
                try {
                    const data = await makeApiRequest('/soccer_epl/odds', {
                        regions: 'us,uk,eu',
                        markets: 'h2h,spreads,totals',
                        oddsFormat: 'decimal'
                    });
                    
                    return data.data || [];
                } catch (error) {
                    console.error('Error getting betting odds:', error);
                    return [];
                }
            }
            return [];
        }

        // Funci√≥n para mostrar cuotas en el an√°lisis
        function displayBettingOdds(odds) {
            if (!odds || odds.length === 0) return '';
            
            return `
                <div class="data-table">
                    <h3>üí∞ Cuotas de Apuestas</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Casa de Apuestas</th>
                                <th>Local</th>
                                <th>Empate</th>
                                <th>Visitante</th>
                                <th>M√°s de 2.5</th>
                                <th>Menos de 2.5</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${odds.slice(0, 5).map(odd => `
                                <tr>
                                    <td>${odd.bookmaker || 'N/A'}</td>
                                    <td>${odd.home || 'N/A'}</td>
                                    <td>${odd.draw || 'N/A'}</td>
                                    <td>${odd.away || 'N/A'}</td>
                                    <td>${odd.over || 'N/A'}</td>
                                    <td>${odd.under || 'N/A'}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Funci√≥n para analizar con diferentes APIs seg√∫n sus fortalezas
        async function getEnhancedAnalysis(homeTeamId, awayTeamId, league, season) {
            const analysis = {
                teams: await Promise.all([
                    getTeamAnalysis(homeTeamId, league, season, true),
                    getTeamAnalysis(awayTeamId, league, season, false)
                ]),
                h2h: await getHeadToHead(homeTeamId, awayTeamId),
                odds: await getBettingOdds(homeTeamId, awayTeamId),
                injuries: await getInjuryReport(homeTeamId, awayTeamId),
                weather: await getWeatherInfo(league),
                predictions: await getAIPredictions(homeTeamId, awayTeamId)
            };

            return analysis;
        }

        // Funci√≥n para obtener reporte de lesiones (si la API lo soporta)
        async function getInjuryReport(homeTeamId, awayTeamId) {
            if (API_PROVIDER === 'api-football' || API_PROVIDER === 'rapidapi-football') {
                try {
                    const [homeInjuries, awayInjuries] = await Promise.all([
                        makeApiRequest('/injuries', { team: homeTeamId }),
                        makeApiRequest('/injuries', { team: awayTeamId })
                    ]);
                    
                    return {
                        home: homeInjuries.response || [],
                        away: awayInjuries.response || []
                    };
                } catch (error) {
                    console.error('Error getting injuries:', error);
                    return { home: [], away: [] };
                }
            }
            return { home: [], away: [] };
        }

        // Funci√≥n para obtener informaci√≥n del clima (si disponible)
        async function getWeatherInfo(league) {
            // Implementar seg√∫n disponibilidad de la API
            return {
                temperature: 'N/A',
                conditions: 'N/A',
                wind: 'N/A'
            };
        }

        // Funci√≥n para predicciones AI (si disponible)
        async function getAIPredictions(homeTeamId, awayTeamId) {
            if (API_PROVIDER === 'sportmonks' && API_PLAN !== 'free') {
                try {
                    const predictions = await makeApiRequest('/predictions', {
                        home_team: homeTeamId,
                        away_team: awayTeamId
                    });
                    
                    return predictions.data || {};
                } catch (error) {
                    console.error('Error getting predictions:', error);
                    return {};
                }
            }
            return {};
        }

        // Funci√≥n para comparar planes y recomendar upgrade
        function recommendUpgrade() {
            const currentPlan = API_PLAN;
            const provider = API_PROVIDER;
            const config = API_CONFIGS[provider];
            const usagePercentage = (requestCount / dailyLimit) * 100;

            if (usagePercentage > 80 && currentPlan === 'free') {
                showMessage(`
                    üöÄ Recomendaci√≥n de Upgrade:
                    Est√°s usando ${usagePercentage.toFixed(1)}% de tu l√≠mite.
                    Considera el plan B√°sico de ${config.name} por ${config.plans.basic?.price || 'N/A'}
                    para obtener m√°s requests y caracter√≠sticas adicionales.
                `, 'success');
            }
        }

        // Funci√≥n para exportar configuraci√≥n de API
        function exportApiConfig() {
            const config = {
                provider: API_PROVIDER,
                plan: API_PLAN,
                endpoint: API_ENDPOINT,
                // No exportar la API Key por seguridad
                timestamp: new Date().toISOString()
            };

            const configJson = JSON.stringify(config, null, 2);
            downloadFile(configJson, 'api-config.json', 'application/json');
            showMessage('Configuraci√≥n exportada correctamente', 'success');
        }

        // Funci√≥n para importar configuraci√≥n de API
        function importApiConfig() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const config = JSON.parse(e.target.result);
                            
                            document.getElementById('apiProvider').value = config.provider || 'api-football';
                            updateApiConfig();
                            document.getElementById('apiPlan').value = config.plan || 'free';
                            updatePlanLimits();
                            document.getElementById('apiEndpoint').value = config.endpoint || '';
                            
                            showMessage('Configuraci√≥n importada correctamente. Recuerda ingresar tu API Key.', 'success');
                        } catch (error) {
                            showMessage('Error al importar configuraci√≥n: ' + error.message, 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            
            input.click();
        }

        // Poblar selects de equipos
        function populateTeamSelects(teams) {
            const homeSelect = document.getElementById('homeTeam');
            const awaySelect = document.getElementById('awayTeam');
            
            // Limpiar opciones previas
            homeSelect.innerHTML = '<option value="">Seleccionar Equipo Local</option>';
            awaySelect.innerHTML = '<option value="">Seleccionar Equipo Visitante</option>';
            
            teams.forEach(teamData => {
                const team = teamData.team;
                const optionHome = document.createElement('option');
                const optionAway = document.createElement('option');
                
                optionHome.value = team.id;
                optionHome.textContent = team.name;
                optionAway.value = team.id;
                optionAway.textContent = team.name;
                
                homeSelect.appendChild(optionHome);
                awaySelect.appendChild(optionAway);
            });
        }

        // Analizar partido
        async function analyzeMatch() {
            const homeTeamId = document.getElementById('homeTeam').value;
            const awayTeamId = document.getElementById('awayTeam').value;
            const league = document.getElementById('leagueSelect').value;
            const season = document.getElementById('season').value;

            if (!homeTeamId || !awayTeamId || !league || !API_KEY) {
                showMessage('Por favor completa todos los campos', 'error');
                return;
            }

            if (homeTeamId === awayTeamId) {
                showMessage('Los equipos deben ser diferentes', 'error');
                return;
            }

            try {
                showMessage('Analizando partido...', 'loading');
                
                // Obtener datos de ambos equipos
                const [homeTeamData, awayTeamData] = await Promise.all([
                    getTeamAnalysis(homeTeamId, league, season, true),
                    getTeamAnalysis(awayTeamId, league, season, false)
                ]);

                // Obtener historial entre equipos
                const h2hData = await getHeadToHead(homeTeamId, awayTeamId);

                // Mostrar an√°lisis
                displayAnalysis(homeTeamData, awayTeamData, h2hData);
                
            } catch (error) {
                showMessage('Error en el an√°lisis: ' + error.message, 'error');
            }
        }

        // Obtener an√°lisis completo de un equipo con m√∫ltiples APIs
        async function getTeamAnalysis(teamId, league, season, isHome) {
            const leagueId = LEAGUES[league].id;
            const venue = isHome ? 'home' : 'away';
            
            try {
                let fixturesData, statsData;
                
                switch (API_PROVIDER) {
                    case 'api-football':
                    case 'rapidapi-football':
                        // Obtener √∫ltimos 10 partidos
                        fixturesData = await makeApiRequest('/fixtures', { 
                            team: teamId, 
                            league: leagueId, 
                            season, 
                            last: 10 
                        });
                        
                        // Obtener estad√≠sticas del equipo
                        statsData = await makeApiRequest('/teams/statistics', { 
                            league: leagueId, 
                            season, 
                            team: teamId 
                        });
                        break;
                    
                    case 'football-data':
                        // Football-Data usa diferentes endpoints
                        fixturesData = await makeApiRequest(`/teams/${teamId}/matches`, { 
                            competitions: leagueId,
                            limit: 10
                        });
                        
                        // Las estad√≠sticas pueden no estar disponibles en el plan gratuito
                        statsData = { response: {} };
                        break;
                    
                    case 'sportmonks':
                        fixturesData = await makeApiRequest(`/fixtures`, { 
                            'filter[localteam_id]': teamId,
                            'filter[season_id]': season,
                            'include': 'stats',
                            limit: 10
                        });
                        statsData = { response: {} };
                        break;
                    
                    default:
                        // API gen√©rica
                        fixturesData = await makeApiRequest('/fixtures', { 
                            team: teamId, 
                            season, 
                            limit: 10 
                        });
                        statsData = await makeApiRequest('/teams/stats', { 
                            team: teamId, 
                            season 
                        });
                }

                // Procesar datos seg√∫n la respuesta de la API
                const fixtures = fixturesData?.response || fixturesData?.matches || fixturesData?.data || [];
                const statistics = statsData?.response || {};

                return {
                    teamId,
                    fixtures,
                    statistics,
                    venue,
                    analysis: calculateTeamAnalysis(fixtures, statistics, venue)
                };
            } catch (error) {
                console.error('Error getting team analysis:', error);
                // Retornar datos vac√≠os en caso de error
                return {
                    teamId,
                    fixtures: [],
                    statistics: {},
                    venue,
                    analysis: getEmptyAnalysis()
                };
            }
        }

        // Obtener historial entre equipos con m√∫ltiples APIs
        async function getHeadToHead(team1Id, team2Id) {
            try {
                let data;
                
                switch (API_PROVIDER) {
                    case 'api-football':
                    case 'rapidapi-football':
                        data = await makeApiRequest('/fixtures/headtohead', { 
                            h2h: `${team1Id}-${team2Id}`,
                            last: 10 
                        });
                        return data.response || [];
                    
                    case 'football-data':
                        // Football-Data puede requerir endpoints espec√≠ficos
                        data = await makeApiRequest(`/teams/${team1Id}/matches`, { 
                            opponent: team2Id,
                            limit: 10
                        });
                        return data.matches || [];
                    
                    case 'sportmonks':
                        data = await makeApiRequest('/head2head', { 
                            'teams[]': [team1Id, team2Id],
                            limit: 10
                        });
                        return data.data || [];
                    
                    default:
                        data = await makeApiRequest('/fixtures/h2h', { 
                            team1: team1Id,
                            team2: team2Id,
                            limit: 10
                        });
                        return data.data || data.response || [];
                }
            } catch (error) {
                console.error('Error getting head to head:', error);
                return [];
            }
        }

        // An√°lisis vac√≠o para casos de error
        function getEmptyAnalysis() {
            return {
                totalMatches: 0,
                venueMatches: 0,
                wins: 0,
                draws: 0,
                losses: 0,
                goalsFor: 0,
                goalsAgainst: 0,
                avgStats: {
                    shotsTotal: 0,
                    shotsOnTarget: 0,
                    cornerKicks: 0,
                    yellowCards: 0,
                    fouls: 0,
                    offsides: 0
                },
                avgGoalsFor: '0.00',
                avgGoalsAgainst: '0.00',
                winPercentage: '0.0'
            };
        }

                        // Obtener estad√≠sticas del equipo
            statsResponse = await fetch(`https://v3.football.api-sports.io/teams/statistics?league=${leagueId}&season=${season}&team=${teamId}`, {
                headers: {
                    'X-RapidAPI-Key': API_KEY,
                    'X-RapidAPI-Host': 'v3.football.api-sports.io'
                }
            });

            const fixturesData = await fixturesResponse.json();
            const statsData = await statsResponse.json();

            // Procesar datos
            return {
                teamId,
                fixtures: fixturesData.response || [],
                statistics: statsData.response || {},
                venue,
                analysis: calculateTeamAnalysis(fixturesData.response || [], statsData.response || {}, venue)
            };
        }

        // Calcular an√°lisis del equipo
        function calculateTeamAnalysis(fixtures, statistics, venue) {
            const venueFixtures = fixtures.filter(fixture => 
                (venue === 'home' && fixture.teams.home.id == fixtures[0]?.teams?.home?.id) ||
                (venue === 'away' && fixture.teams.away.id == fixtures[0]?.teams?.away?.id)
            );

            const analysis = {
                totalMatches: fixtures.length,
                venueMatches: venueFixtures.length,
                wins: 0,
                draws: 0,
                losses: 0,
                goalsFor: 0,
                goalsAgainst: 0,
                avgStats: {
                    shotsTotal: 0,
                    shotsOnTarget: 0,
                    cornerKicks: 0,
                    yellowCards: 0,
                    fouls: 0,
                    offsides: 0
                }
            };

            // Analizar √∫ltimos 10 partidos
            fixtures.forEach(fixture => {
                if (fixture.fixture.status.short === 'FT') {
                    const isHome = fixture.teams.home.id == fixtures[0]?.teams?.home?.id;
                    const teamScore = isHome ? fixture.goals.home : fixture.goals.away;
                    const opponentScore = isHome ? fixture.goals.away : fixture.goals.home;

                    analysis.goalsFor += teamScore || 0;
                    analysis.goalsAgainst += opponentScore || 0;

                    if (teamScore > opponentScore) analysis.wins++;
                    else if (teamScore === opponentScore) analysis.draws++;
                    else analysis.losses++;

                    // Estad√≠sticas del partido
                    if (fixture.statistics) {
                        const teamStats = fixture.statistics.find(s => s.team.id == fixtures[0]?.teams?.home?.id) || 
                                        fixture.statistics.find(s => s.team.id == fixtures[0]?.teams?.away?.id);
                        
                        if (teamStats && teamStats.statistics) {
                            teamStats.statistics.forEach(stat => {
                                const value = parseInt(stat.value) || 0;
                                switch(stat.type) {
                                    case 'Total Shots':
                                        analysis.avgStats.shotsTotal += value;
                                        break;
                                    case 'Shots on Goal':
                                        analysis.avgStats.shotsOnTarget += value;
                                        break;
                                    case 'Corner Kicks':
                                        analysis.avgStats.cornerKicks += value;
                                        break;
                                    case 'Yellow Cards':
                                        analysis.avgStats.yellowCards += value;
                                        break;
                                    case 'Fouls':
                                        analysis.avgStats.fouls += value;
                                        break;
                                    case 'Offsides':
                                        analysis.avgStats.offsides += value;
                                        break;
                                }
                            });
                        }
                    }
                }
            });

            // Calcular promedios
            const matchCount = analysis.totalMatches || 1;
            Object.keys(analysis.avgStats).forEach(key => {
                analysis.avgStats[key] = (analysis.avgStats[key] / matchCount).toFixed(2);
            });

            analysis.avgGoalsFor = (analysis.goalsFor / matchCount).toFixed(2);
            analysis.avgGoalsAgainst = (analysis.goalsAgainst / matchCount).toFixed(2);
            analysis.winPercentage = ((analysis.wins / matchCount) * 100).toFixed(1);

            return analysis;
        }

        // Obtener historial entre equipos eliminado (c√≥digo duplicado ya implementado arriba)

        // Mostrar an√°lisis completo actualizado
        function displayAnalysis(homeData, awayData, h2hData) {
            const resultsDiv = document.getElementById('results');
            
            // Verificar l√≠mites de uso
            recommendUpgrade();
            
            const html = `
                <div class="team-comparison">
                    <div class="team-stats">
                        <h3>üìç Equipo Local</h3>
                        <div class="statistics-grid">
                            <div class="stat-card">
                                <div class="stat-value">${homeData.analysis.winPercentage}%</div>
                                <div class="stat-label">% Victorias</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${homeData.analysis.avgGoalsFor}</div>
                                <div class="stat-label">Goles por Partido</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${homeData.analysis.avgStats.shotsTotal}</div>
                                <div class="stat-label">Remates Totales</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${homeData.analysis.avgStats.shotsOnTarget}</div>
                                <div class="stat-label">Remates a Puerta</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${homeData.analysis.avgStats.cornerKicks}</div>
                                <div class="stat-label">Tiros de Esquina</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${homeData.analysis.avgStats.yellowCards}</div>
                                <div class="stat-label">Tarjetas Amarillas</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="vs-badge">VS</div>
                    
                    <div class="team-stats">
                        <h3>‚úàÔ∏è Equipo Visitante</h3>
                        <div class="statistics-grid">
                            <div class="stat-card">
                                <div class="stat-value">${awayData.analysis.winPercentage}%</div>
                                <div class="stat-label">% Victorias</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${awayData.analysis.avgGoalsFor}</div>
                                <div class="stat-label">Goles por Partido</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${awayData.analysis.avgStats.shotsTotal}</div>
                                <div class="stat-label">Remates Totales</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${awayData.analysis.avgStats.shotsOnTarget}</div>
                                <div class="stat-label">Remates a Puerta</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${awayData.analysis.avgStats.cornerKicks}</div>
                                <div class="stat-label">Tiros de Esquina</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value">${awayData.analysis.avgStats.yellowCards}</div>
                                <div class="stat-label">Tarjetas Amarillas</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="data-table">
                    <h3>üìä An√°lisis Estad√≠stico Completo</h3>
                    <p><strong>API Utilizada:</strong> ${API_CONFIGS[API_PROVIDER].name} - Plan ${API_PLAN.toUpperCase()}</p>
                    <p><strong>Requests Usados:</strong> ${requestCount}/${dailyLimit} (${((requestCount/dailyLimit)*100).toFixed(1)}%)</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Estad√≠stica</th>
                                <th>Local</th>
                                <th>Visitante</th>
                                <th>Promedio</th>
                                <th>Ventaja</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${generateComparisonRows(homeData.analysis, awayData.analysis)}
                        </tbody>
                    </table>
                </div>

                <div class="data-table">
                    <h3>üèÜ Historial Entre Equipos (√öltimos 10 partidos)</h3>
                    ${generateH2HTable(h2hData)}
                </div>

                <div class="data-table">
                    <h3>üìà Recomendaciones de Apuesta</h3>
                    ${generateBettingRecommendations(homeData.analysis, awayData.analysis, h2hData)}
                </div>

                ${displayBettingOdds([])}
            `;

            resultsDiv.innerHTML = html;
            analysisData = { homeData, awayData, h2hData };
        }

        // Generar filas de comparaci√≥n
        function generateComparisonRows(homeAnalysis, awayAnalysis) {
            const stats = [
                { key: 'winPercentage', label: '% Victorias' },
                { key: 'avgGoalsFor', label: 'Goles por Partido' },
                { key: 'avgGoalsAgainst', label: 'Goles Recibidos' },
            ];

            const avgStats = [
                { key: 'shotsTotal', label: 'Remates Totales' },
                { key: 'shotsOnTarget', label: 'Remates a Puerta' },
                { key: 'cornerKicks', label: 'Tiros de Esquina' },
                { key: 'yellowCards', label: 'Tarjetas Amarillas' },
                { key: 'fouls', label: 'Faltas' },
                { key: 'offsides', label: 'Fueras de Juego' }
            ];

            let rows = '';

            stats
